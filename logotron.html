<!DOCTYPE html>
<meta charset="utf-8">
<title>Logotron!</title>
<script src="jquery.min.js"></script>
<script>
var Logo = {
  WHITESPACE: /[ \r\n\t]/,
  LITERALS: /[ \[\]]/,
  tokenize: function Logo_tokenize(str) {
    var tokens = [];
    var state = 'blank';
    var stateStartI = 0;
    var i;
    var letter;

    var stateMethods = {
      blank: function() {
        if (Logo.WHITESPACE.test(letter))
          return;
        if (Logo.LITERALS.test(letter))
          return setState('characterSymbol');
        if (letter == ';')
          return setState('comment');
        setState('word');
      },
      word: function() {
        if (Logo.WHITESPACE.test(letter))
          return setState('blank');
        if (Logo.LITERALS.test(letter))
          return setState('characterSymbol');
        if (letter == ';')
          return setState('comment');
      },
      comment: function() {
        if (letter == '\n')
          setState('blank');
      },
      characterSymbol: function() {
        setState('blank');
        this.blank();
      }
    };

    function setState(name) {
      if (state != name) {
        if (i > stateStartI)
          tokens.push({
            name: state,
            value: str.slice(stateStartI, i),
            start: stateStartI,
            end: i
          });
        state = name;
        stateStartI = i;
      }
    }

    for (i = 0; i < str.length; i++) {
      letter = str[i];      
      stateMethods[state]();
    }

    setState(null);
    
    return tokens;
  }
};

$(window).ready(function() {
  var lastCodeValue;

  $("#raw-code").hide();
  $("#rendered-code").show();
  $("#rendered-code").click(function() {
    $(this).hide();
    $("#raw-code").show();
    $("#raw-code").focus();
  });
  
  $("#raw-code").blur(function() {
    var currVal = $(this).val();
    if (currVal != lastCodeValue) {
      lastCodeValue = currVal;
      var tokens = Logo.tokenize(lastCodeValue);
      $("#rendered-code").empty();
      tokens.forEach(function(token) {
        var span = $('<span class="token"></span>');
        span.addClass(token.name);
        span.text(token.value);
        $("#rendered-code").append(span);
      });
    }
    $(this).hide();
    $("#rendered-code").show();
  });
});
</script>
<style>
#rendered-code span {
  white-space: pre-wrap;
}

.token.comment {
  color: firebrick;
}

.token.characterSymbol {
  color: gray;
}

.code {
  width: 40em;
  height: 40em;
  outline: none;
  font-family: Monaco, monospace;
  font-size: 10pt;
  border: 1px dotted gray;
  padding: 1em;
}
</style>
<textarea id="raw-code" class="code"></textarea>
<div id="rendered-code" class="code"></div>
