<!DOCTYPE html>
<meta charset="utf-8">
<title>Logotron!</title>
<link rel="stylesheet" href="tipsy.css">
<script src="jquery.min.js"></script>
<script src="jquery.tipsy.js"></script>
<script src="logo.js"></script>
<script>
function renderCode(code) {
  var tokens = Logo.tokenize(code);
  $("#rendered-code").empty();
  tokens.forEach(function(token) {
    var span = $('<span class="token"></span>');
    span.addClass(token.name);
    span.text(token.value);
    token.query = span;
    $("#rendered-code").append(span);
  });
  var program = Logo.parse(tokens);
  tokens.forEach(function(token) {
    if (token.tags.length)
      token.query.addClass(token.tags.join(" "));
    if (token.messages.length) {
      var message = token.messages.join(" ");
      token.query.attr("title", message);
      token.query.tipsy({gravity: 'nw'});
    }
  });
}

$(window).ready(function() {
  var lastCodeValue;

  $("#raw-code").hide();
  $("#rendered-code").show();
  $("#rendered-code").click(function() {
    $(this).hide();
    $("#raw-code").show();
    $("#raw-code").focus();
  });
  
  $("#raw-code").blur(function() {
    var currVal = $(this).val();
    if (currVal != lastCodeValue) {
      lastCodeValue = currVal;
      renderCode(lastCodeValue);
    }
    $(this).hide();
    $("#rendered-code").show();
  });
});
</script>
<style>
#rendered-code span {
  white-space: pre-wrap;
}

.token.comment {
  color: firebrick;
}

.token.characterSymbol {
  color: gray;
}

.token.broken {
  text-decoration: line-through;
}

.token.unparsed {
  color: #c0c0c0;
}

.token.fatal {
  color: red;
}

.token.defined-word {
  font-weight: bold;
}

.token.argument-name {
  font-style: italic;
}

.code {
  width: 40em;
  height: 40em;
  outline: none;
  font-family: Monaco, monospace;
  font-size: 10pt;
  border: 1px dotted gray;
  padding: 1em;
}
</style>
<textarea id="raw-code" class="code"></textarea>
<div id="rendered-code" class="code"></div>
